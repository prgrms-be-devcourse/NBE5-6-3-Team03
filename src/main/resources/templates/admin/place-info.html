<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>place list</title>
  <link rel="stylesheet" href="/static/css/styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    .place-card {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      padding: 1.5rem;
    }
    .place-info {
      flex-grow: 1;
    }
    .place-id {
      font-size: 0.85rem;
    }
  </style>

</head>
<body class="bg-light">

<div class="container py-5">
  <h1 class="display-5 text-center text-primary mb-4">ğŸ—ºï¸ ë“±ë¡ëœ ì¥ì†Œ ëª©ë¡</h1>

  <!-- âœ… í•„í„° Select -->
  <div class="row mb-4">
    <div class="col-md-4">
      <select id="countryFilter" class="form-select">
        <option value="">ğŸŒ ëª¨ë“  êµ­ê°€ ë³´ê¸°</option>
        <option th:each="country : ${countries}" th:value="${country}" th:text="${country}"></option>
      </select>
    </div>
    <div class="col-md-4">
      <select id="cityFilter" class="form-select">
        <option value="">ğŸ™ï¸ ëª¨ë“  ë„ì‹œ ë³´ê¸°</option>
        <!-- JavaScriptë¡œ ë™ì ìœ¼ë¡œ ì±„ì›€ -->
      </select>
    </div>
  </div>

  <!-- âœ… ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ -->
  <div class="row g-3" id="placeList">
    <div class="col-12" th:each="place : ${places}"
         th:attr="data-country=${place.country}, data-city=${place.city}">
      <div class="card shadow-sm border-0 place-card">
        <div class="place-info">
          <h5 class="text-primary mb-1" th:text="${place.placeName}">ì¥ì†Œëª…</h5>
          <div class="text-muted mb-2">
            <span th:text="${place.city}">ë„ì‹œ</span>,
            <span th:text="${place.country}">êµ­ê°€</span>
          </div>
          <div class="mb-1"><strong>ìœ„ë„:</strong> <span th:text="${place.latitude}">lat</span></div>
          <div class="mb-1"><strong>ê²½ë„:</strong> <span th:text="${place.longitude}">lng</span></div>
        </div>

        <!-- ìš°ì¸¡ í•˜ë‹¨: ID + ë²„íŠ¼ -->
        <div class="text-end text-muted place-id">
          <div>
            ID: <span th:text="${place.placeId}">placeId</span>
          </div>
          <div class="mt-2">
            <a href="#" class="btn btn-sm btn-outline-primary me-1 edit-btn"
               th:attr="data-id=${place.placeId},
              data-name=${place.placeName},
              data-country=${place.country},
              data-city=${place.city},
              data-lat=${place.latitude},
              data-lng=${place.longitude}">
              âœï¸ ìˆ˜ì •
            </a>
            <a th:href="@{/place/places/{id}/delete(id=${place.placeId})}"
               onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');"
               class="btn btn-sm btn-outline-danger">ğŸ—‘ ì‚­ì œ</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <form id="editForm" method="post">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">ì¥ì†Œ ì •ë³´ ìˆ˜ì •</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="placeId" id="editPlaceId">

          <div class="mb-3">
            <label for="editPlaceName" class="form-label">ì¥ì†Œëª…</label>
            <input type="text" class="form-control" id="editPlaceName" name="placeName" required>
          </div>
          <div class="mb-3">
            <label for="editCountry" class="form-label">êµ­ê°€</label>
            <input type="text" class="form-control" id="editCountry" name="country" required>
          </div>
          <div class="mb-3">
            <label for="editCity" class="form-label">ë„ì‹œ</label>
            <input type="text" class="form-control" id="editCity" name="city" required>
          </div>
          <div class="mb-3">
            <label for="editLatitude" class="form-label">ìœ„ë„</label>
            <input type="number" step="any" class="form-control" id="editLatitude" name="latitude" required>
          </div>
          <div class="mb-3">
            <label for="editLongitude" class="form-label">ê²½ë„</label>
            <input type="number" step="any" class="form-control" id="editLongitude" name="longitude" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          <button type="submit" class="btn btn-primary">ì €ì¥</button>
        </div>
      </div>
    </form>
  </div>
</div>


<!-- âœ… í•„í„°ë§ ìŠ¤í¬ë¦½íŠ¸ -->
<script th:inline="javascript">
  let allPlaces = /*[[${places}]]*/ [];
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const countrySelect = document.getElementById('countryFilter');
    const citySelect = document.getElementById('cityFilter');
    const cards = document.querySelectorAll('#placeList > .col-12');

    function getCitiesByCountry(country) {
      const cities = new Set();
      allPlaces.forEach(place => {
        if (!country || place.country === country) {
          cities.add(place.city);
        }
      });
      return Array.from(cities).sort();
    }

    function updateCityOptions(country) {
      const cities = getCitiesByCountry(country);
      citySelect.innerHTML = '<option value="">ğŸ™ï¸ ëª¨ë“  ë„ì‹œ ë³´ê¸°</option>';
      cities.forEach(city => {
        const option = document.createElement('option');
        option.value = city;
        option.textContent = city;
        citySelect.appendChild(option);
      });
    }

    function filterCards() {
      const selectedCountry = countrySelect.value;
      const selectedCity = citySelect.value;

      cards.forEach(card => {
        const country = card.getAttribute('data-country');
        const city = card.getAttribute('data-city');
        const show = (!selectedCountry || country === selectedCountry) &&
            (!selectedCity || city === selectedCity);
        card.style.display = show ? 'block' : 'none';
      });
    }

    countrySelect.addEventListener('change', function () {
      updateCityOptions(this.value);
      filterCards();
    });

    citySelect.addEventListener('change', filterCards);

    // ì´ˆê¸° ë„ì‹œ ì˜µì…˜ ì „ì²´ ë¡œë”©
    updateCityOptions('');
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const editButtons = document.querySelectorAll('.edit-btn');
    const modal = new bootstrap.Modal(document.getElementById('editModal'));
    const form = document.getElementById('editForm');

    editButtons.forEach(btn => {
      btn.addEventListener('click', function (e) {
        e.preventDefault(); // ê¸°ë³¸ ë§í¬ ë°©ì§€

        // ë°ì´í„° ì±„ìš°ê¸°
        document.getElementById('editPlaceId').value = this.dataset.id;
        document.getElementById('editPlaceName').value = this.dataset.name;
        document.getElementById('editCountry').value = this.dataset.country;
        document.getElementById('editCity').value = this.dataset.city;
        document.getElementById('editLatitude').value = this.dataset.lat;
        document.getElementById('editLongitude').value = this.dataset.lng;

        // í¼ action ì„¤ì •
        form.action = `/place/places/${this.dataset.id}/edit`;

        // ëª¨ë‹¬ ë„ìš°ê¸°
        modal.show();
      });
    });
  });
</script>

<!-- Bootstrap JS (í•„ìˆ˜) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>